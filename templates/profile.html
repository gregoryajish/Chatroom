<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Settings - Chatroom</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="auth-container">
        <div class="auth-card card" style="max-width: 600px;">
            <div class="auth-header">
                <h1 class="auth-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        style="vertical-align: middle; margin-right: 8px;">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l4.2 4.2M23 12h-6m-6 0H1m18.2 5.2l-4.2-4.2m0-6l4.2-4.2" />
                    </svg>
                    Profile Settings
                </h1>
                <p class="auth-subtitle">Update your profile information</p>
            </div>

            <form method="POST" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <!-- Profile Picture -->
                <div class="profile-picture-section">
                    <div class="profile-picture-preview">
                        {% if profile_picture %}
                        <img src="{{ url_for('static', filename='uploads/profiles/' + profile_picture) }}"
                            alt="Profile Picture" id="preview-image">
                        {% else %}
                        <div class="profile-avatar-large" id="preview-avatar">{{ username[0].upper() }}</div>
                        {% endif %}
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="profile_picture">Profile Picture</label>
                        <input type="file" id="profile_picture" name="profile_picture" class="input-file"
                            accept="image/png,image/jpeg,image/jpg,image/gif" onchange="previewImage(event)">
                        <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                            Max size: 5MB. Formats: JPG, PNG, GIF
                        </small>
                    </div>
                </div>

                <!-- Username (Read-only) -->
                <div class="input-group">
                    <label class="input-label" for="username">Username</label>
                    <input type="text" id="username" class="input" value="{{ username }}" disabled>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                        Username cannot be changed
                    </small>
                </div>

                <!-- Email -->
                <div class="input-group">
                    <label class="input-label" for="email">Email / Phone</label>
                    <input type="text" id="email" name="email" class="input" placeholder="Enter your email or phone"
                        value="{{ email or '' }}">
                </div>

                <!-- Bio -->
                <div class="input-group">
                    <label class="input-label" for="bio">Bio / Status</label>
                    <textarea id="bio" name="bio" class="input" rows="3"
                        placeholder="Tell us about yourself...">{{ bio or '' }}</textarea>
                </div>

                <!-- Buttons -->
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                        Save Changes
                    </button>
                    <a href="/chat" class="btn btn-secondary" style="flex: 1; text-align: center;">
                        ‚Üê Back to Chat
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script>
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    // Remove avatar if exists
                    const avatar = document.getElementById('preview-avatar');
                    if (avatar) {
                        avatar.remove();
                    }

                    // Create or update image preview
                    let img = document.getElementById('preview-image');
                    if (!img) {
                        img = document.createElement('img');
                        img.id = 'preview-image';
                        img.alt = 'Profile Picture';
                        document.querySelector('.profile-picture-preview').appendChild(img);
                    }
                    img.src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }
    </script>
</body>

</html>